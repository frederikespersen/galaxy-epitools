<tool id="calc-tap" name="Calculate TAP" version="1.0">

    <description> Therapeutic Antibody Profiler from Deane lab</description>

    <requirements>
        <requirement type="package" version="2.2.3">pandas</requirement>
        <requirement type="package" version="1.26.4">numpy</requirement>
        <requirement type="package" version="1.84">biopython</requirement>
    </requirements>

    <command><![CDATA[
    mkdir input_pdbs;
        #for $pdb_dat in $input_pdbs:
            cp -- $pdb_dat "input_pdbs/$pdb_dat.element_identifier";
        #end for
        python $__tool_directory__/calc-tap.py
                --input-pdbs \$(ls input_pdbs/*.pdb)
                --output-tsv $output_tsv
    ]]></command>

    <inputs>
        <param argument="--input-pdbs" type="data_collection" format="pdb" label="Input Ab PDBs" help="PDB files of antibody structures generated by ABodyBuilder2"/>
    </inputs>

    <outputs>
        <data name="output_tsv" format="tabular" label="${tool.name}: TAP scores"/>
    </outputs>

    <help><![CDATA[
    
    .. class:: infomark.

    **What it does**

    This tools takes one or more PDB files generated by ABodyBuilder2 and 
    calculates the [Therapeutic Antibody Profiler (TAP)](https://doi.org/10.1073/pnas.1810576116) measures from the Charlotte Deane lab.

    These measures are:

        1. Total CDR length (``cdr_len``),
        2. Patches of surface hydrophobicity in CDR vicinty (PSH) (``psh_cdr``),
        3. Patches of positive charge in CDR vicinty (PPC) (``ppc_cdr``),
        4. Patches of negative charge in CDR vicinty (PNC) (``pnc_cdr``),
        5. And the structural Fv charge symmetry parameter (SFvCSP) (``sfvcsp``)
    
    ]]></help>
    
    <citations>
        <citation type="doi">10.1073/pnas.1810576116</citation>
        <citation type="doi">10.1038/s42003-023-05744-8</citation>
    </citations>

</tool>